program dumper;	uses		traps, 						{ Listing ToolBox units first. }		utils, resHandling;	var		gFinished: boolean;		gHasWNE: boolean;	procedure DoAboutBox;	begin		if alert(rAboutBoxALRT, nil) <> 0 then			;	end;	procedure doAppleMenuChoice (itemNo: integer);		var			itemName: str255;			daDriverRefNum: integer;	begin		case itemNo of			iAbout: 				doAboutBox;			otherwise				begin					GetItem(getMHandle(mApple), itemNo, itemName);					daDriverRefNum := OpenDeskAcc(itemName);				end;		end;	end;	procedure DoDumpMenuChoice (itemNo: integer);	begin		case itemNo of			iDumpToData: 				DumpToFiles;			iChangeResourceTypes: 				ChangeToNewResType;			iQuit: 				gFinished := true;		end;	end;	procedure handleMenuChoice (menuChoice: longint);	begin		case (HiWord(menuChoice)) of			mApple: 				doAppleMenuChoice(LoWord(menuChoice));			mDump: 				doDumpMenuChoice(LoWord(menuChoice));			mEdit: 				;			otherwise				;		end;	end;	function eventGetter (eventMask: integer;									var theEvent: EventRecord): boolean;	begin		if gHasWNE then			eventGetter := WaitNextEvent(eventMask, theEvent, 8, nil)		else			begin				eventGetter := GetNextEvent(eventMask, theEvent);			end;	end;	procedure mainLoop;		var			theEvent: EventRecord;			partCode: integer;			theWindow: WindowPtr;			menuChoice: longint;	begin		repeat			hiliteMenu(0);			if eventGetter(everyEvent, theEvent) then				begin					case theEvent.what of						updateEvt: 							doUpdate(theEvent.message);						keyDown: 							if (BAnd(theEvent.modifiers, cmdKey) <> 0) then								HandleMenuChoice(MenuKey(CHR(BAnd(theEvent.message, charCodeMask))));						mouseDown: 							begin								partCode := FindWindow(theEvent.where, theWindow);								case partCode of									inSysWindow: 										SystemClick(theEvent, theWindow);									inContent: 										if (theWindow <> FrontWindow) then											SelectWindow(theWindow);									inDrag: 										DragWindow(theWindow, theEvent.where, screenBits.bounds);									inMenuBar: 										begin											menuChoice := MenuSelect(theEvent.where);											if menuChoice <> 0 then												HandleMenuChoice(menuChoice);										end;									otherwise										;								end;							end;						otherwise							;					end;				end;		until gFinished;		;	end;	procedure toolBoxInit;	begin		InitCursor;		FlushEvents(everyEvent, 0);	end;	procedure setupUI;		var			menubarHdl: handle;	begin		menubarHdl := GetNewMBar(rMBarID);		if (menubarHdl <> nil) then			begin				SetMenuBar(menubarHdl);				AddResMenu(GetMHandle(mApple), 'DRVR');				DrawMenuBar;			end;	end;	procedure initProgram;	begin		toolboxInit;		setupUI;		gFinished := false;		gHasWNE := trapAvailable(_WaitNextEvent);	end;begin	initProgram;{$IFC DEBUGGING}	DisplayInformationalAlert('Setup complete!');{$ENDC}	mainLoop;{$IFC DEBUGGING}	DisplayInformationalAlert('Main loop exited!');{$ENDC}end.